# Provisioning a demo Web project in Google Compute Platform

## Overview

This project aims to demonstrate how to set up an infrastructure for a
small web application that has multiple http frontends (with load-balancing and auto-scaling),
and a single database backend.

Although it is not that difficult to build this via the GUI, the secondary goal is to
accomplish all this in an automated manner, so this whole infrastructure shall be
replicable easily and without human interaction.


## The architecture

The installation of this infrastructure is based on the Google Cloud Platform,
and all its parts will be deployed in a single Project, so it will be completely
separate from any other activities of our cloud account.

For the autoscaling feature the frontends must be fully cloneable, so they
will be a Managed Instance Pool, and for that we need an Instance Template.

That template is generated by creating a 'Golden' instance, setting up all
the packages and building all prerequisites on it, and then using its disk
to create the Instance Template.


## Installing the Golden instance of the frontend

This step has to be performed only once, and later if we already have the
image, future deployments can just refer to it. (Until we want to re-create
the image, for example, because the application has evolved in the meantime.)

For this reason, this step resides in a separate folder: `00_create_websvr_golden_template`.

The infrastructure management is done via Terraform, so the commands are:

* `terraform init` 
* `terraform plan` 
* `terraform apply` 
* `terraform destroy` 

As other parts of the project will also use the same credentials, they are
in the project root in `common.auto.tfvars`, which is just symlinked here.

Also, the files `provisioner.pem`, `provisioner.openssh.pub`, `service_account.json`
there, and the `terraform.tfvars` here contain credential information, which has
to be actualised with valid values before use.

Once the infrastructure is created, we can continue with the software deployment:

* `ansible-playbook -i inventory.gcp_compute.yaml websrv_golden.install.yaml -v`

## To Be Continued ...
